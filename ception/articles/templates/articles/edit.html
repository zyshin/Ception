{% extends 'base.html' %}
{% load staticfiles %}
{% load i18n %}

{% block head %}
  <link href="{% static 'css/articles.css' %}" rel="stylesheet">
  <script src="{% static 'js/articles.js' %}"></script>
  <script src="{% static 'js/edit.js' %}"></script>
{% endblock head %}

{% block main %}
  <ol class="breadcrumb">
    <li><a href="{% url 'articles' %}">{% trans 'Articles' %}</a></li>
    <li><a href="{% url 'article' form.instance.origin.slug %}">{{ form.instance.origin.title }}</a></li>
    <li class="active">{% trans 'Edit' %}</li>
  </ol>
  <div class="row">
    <div class="col-md-8">
      <h2><a href="{% url 'article' form.instance.origin.slug %}">{{ form.instance.origin.title }}</a></h2>

      <div class="info">
        <span class="date">
          <span class="glyphicon glyphicon-calendar"></span>
          {{ form.instance.origin.create_date }}
        </span>
        <span class="user">
          <a href="{% url 'profile' form.instance.origin.create_user.username %}"><img
              src="{{ form.instance.origin.create_user.profile.get_picture }}"></a>
          <a href="{% url 'profile' form.instance.origin.create_user.username %}">{{ form.instance.origin.create_user.profile.get_screen_name }}</a>
        </span>
        <span class="edit">
          <span class="glyphicon glyphicon-pencil"></span>
          10 Edits
        </span>
      </div>

      <form action="{% url 'edit_logic' form.instance.pk %}" id="edit_form" method="post" role="form">
        {% csrf_token %}
        {% for field in form.visible_fields %}
          <div class="form-group{% if field.errors %} has-error{% endif %}">
            {{ field }}
            {% if field.help_text %}
              <span class="help-block">{{ field.help_text }}</span>
            {% endif %}
            {% for error in field.errors %}
              <label class="control-label">{{ error }}</label>
            {% endfor %}
          </div>
        {% endfor %}
      </form>

      <div id="selected-sentence" class="selected-div"></div>
      <div id="selected-id" class="id-div" style="background-color: thistle; height: 20px"></div>
      {% for a in authors %}
        <div id="block-{{ a }}">
          <div id="c-{{ a }}" class="compare-div"></div>
          <div class="post-comment clearfix">
            <form role="form" id="comment-form-{{ a }}">
              {% csrf_token %}
              <input type="hidden" name="version_id" id="version_id-{{ a }}" value="{{ form.instance.pk }}">
              <input type="hidden" name="sentence_id" id="sentence_id-{{ a }}" value="0">
              <div class="comment-input clearfix">
                <textarea class="form-control sentence-comment" rows="1" placeholder="{% trans 'Write a comment...' %}"
                          name="sentence-comment" id="sentence-comment" data-author="{{ a }}"></textarea>
              </div>
            </form>
          </div>
          <div class="well well-sm" id="t-{{ a }}"></div>
        </div>
      {% endfor %}
    </div>
    <div class="col-md-4">
      <div class="row">
        <div class="col-md-6">
          <a href="javascript:document.getElementById('edit_form').submit()"
             class="btn btn-primary publish btn-block">{% trans 'Save' %}</a>
        </div>
        <div class="col-md-6">
          <a href="{% url 'article' form.instance.origin.slug %}"
             class="btn btn-default btn-block">{% trans 'Cancel' %}</a>
        </div>
      </div>

      <div class="row">
        <div id="summary-window">
          <ul class="nav nav-tabs nav-justified">
            <li class="active"><a data-toggle="pill" href="#summary">Summary</a></li>
            <li><a data-toggle="pill" href="#detail">Detail</a></li>
          </ul>
          <div class="tab-content">
            <div id="summary" class="tab-pane fade in active">
              <h3>HOME</h3>
              <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
                dolore magna aliqua.</p>
            </div>
            <div id="detail" class="tab-pane fade">
              <h3>Menu 1</h3>
              <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
                consequat.</p>
            </div>
          </div>
        </div>
      </div>

    </div>

    <script>
    (function () {
      var version_id = {{ form.instance.pk }};
      var current_user = "{{ user }}";
      var json_str_array = {{ jsons|safe }};
      initEditPage(version_id, current_user, json_str_array);
    })();
  </script>
  </div>


{% endblock main %}
